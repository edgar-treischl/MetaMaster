<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>MetaMaster • MetaMaster</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/Lato-0.4.9/font.css" rel="stylesheet">
<link href="../deps/Bungee-0.4.9/font.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="MetaMaster">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">MetaMaster</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Released version">0.0.1</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="active nav-item"><a class="nav-link" href="../articles/MetaMaster.html">Get started</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav"></ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>MetaMaster</h1>
            
      

      <div class="d-none name"><code>MetaMaster.Rmd</code></div>
    </div>

    
    
<p>The MetaMaster package creates the <em>master meta data</em>. The
latter are meta data for Lime Survey which are reproducible, tested, and
- in consequence - error-free. To this end, the package provides
functions to exchange data via the Lime Survey API (<code>LS_*</code>)
and to work with a PostgreSQL (<code>DB_*</code>) database. Furthermore,
the package introduces consistency checks and further helpers to
automate the process to build meta data for Lime Survey.</p>
<p>In order to use the package, you must provide credentials and other
parameters to get access to the Lime Survey API (e.g., user name). The
MetaMaster packages relies on the <code>config</code> package and all
necessary parameters need to be available in the <code>config.yml</code>
file in the working directory <span class="citation">(Allaire
2023)</span>. The next console shows an example.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="fu">default</span><span class="kw">:</span></span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a><span class="at">  </span><span class="fu">tmp.server</span><span class="kw">:</span><span class="at"> </span><span class="st">"Name"</span></span>
<span id="cb1-3"><a href="#cb1-3" tabindex="-1"></a><span class="at">  </span><span class="fu">api_url</span><span class="kw">:</span><span class="at"> </span><span class="st">"URL"</span></span>
<span id="cb1-4"><a href="#cb1-4" tabindex="-1"></a><span class="at">  </span><span class="fu">tmp.user</span><span class="kw">:</span><span class="at"> </span><span class="st">"user"</span></span>
<span id="cb1-5"><a href="#cb1-5" tabindex="-1"></a><span class="at">  </span><span class="fu">tmp.credential</span><span class="kw">:</span><span class="at"> </span><span class="st">"Password"</span></span>
<span id="cb1-6"><a href="#cb1-6" tabindex="-1"></a><span class="at">  </span></span>
<span id="cb1-7"><a href="#cb1-7" tabindex="-1"></a><span class="fu">test</span><span class="kw">:</span></span>
<span id="cb1-8"><a href="#cb1-8" tabindex="-1"></a><span class="at">  </span><span class="fu">tmp.server</span><span class="kw">:</span><span class="at"> </span><span class="st">"Name"</span></span>
<span id="cb1-9"><a href="#cb1-9" tabindex="-1"></a><span class="at">  </span><span class="fu">api_url</span><span class="kw">:</span><span class="at"> </span><span class="st">"URL"</span></span>
<span id="cb1-10"><a href="#cb1-10" tabindex="-1"></a><span class="at">  </span><span class="fu">tmp.user</span><span class="kw">:</span><span class="at"> </span><span class="st">"user"</span></span>
<span id="cb1-11"><a href="#cb1-11" tabindex="-1"></a><span class="at">  </span><span class="fu">tmp.credential</span><span class="kw">:</span><span class="at"> </span><span class="st">"Password"</span></span></code></pre></div>
<p>In case there is no config file yet, create a new one with the
<code><a href="../reference/create_config.html">create_config()</a></code> function which has all default parameters
included. Furthermore, the config package picks the <em>default</em>
parameters without any adjustments. To use the configuration for a
different environment (e.g., <code>test</code>), update the
environmental variable <code>R_CONFIG_ACTIVE</code>. The master
templates of the OES live in the <code>test</code> environment which is
why we set it accordingly to build the meta data.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#Set the R_CONFIG_ACTIVE</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">MetaMaster</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Sys.setenv.html" class="external-link">Sys.setenv</a></span><span class="op">(</span>R_CONFIG_ACTIVE <span class="op">=</span> <span class="st">"test"</span><span class="op">)</span></span></code></pre></div>
<div class="section level2">
<h2 id="metamaster-in-action">MetaMaster in Action<a class="anchor" aria-label="anchor" href="#metamaster-in-action"></a>
</h2>
<p>Let’s build the master meta data: (1) We download the raw data via
the Lime Survey API. (2) We build the master meta data based on the raw
data. (3) We run consistency checks and inspect the results in an email
report. (4) We update the results to the database. The
<code><a href="../reference/build.html">build()</a></code> function runs these steps in sequence:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/build.html">build</a></span><span class="op">(</span>send_report <span class="op">=</span> <span class="cn">TRUE</span>, update <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># ℹ Starting the build process...</span></span>
<span><span class="co"># ℹ Fetching raw meta data from Lime Survey</span></span>
<span><span class="co"># ✔ Raw meta data exported.                          </span></span>
<span><span class="co"># ℹ Building metadata for the master data...</span></span>
<span><span class="co"># ✔ MetaMaster exported.                  </span></span>
<span><span class="co"># ✔ The table 'metadata_raw' has been successfully uploaded to the database.</span></span>
<span><span class="co"># ℹ Sending the report...</span></span>
<span><span class="co"># The email message was sent successfully.                       </span></span>
<span><span class="co"># ✔ By the power of Grayskull: Building process completed.</span></span></code></pre></div>
<p>The following console displays the <code><a href="../reference/build.html">build()</a></code> function and
the next section outlines what happens under the hood.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#Build the Meta Master Data</span></span>
<span><span class="va">build</span></span>
<span><span class="co">#&gt; function (send_report = FALSE, update = FALSE) </span></span>
<span><span class="co">#&gt; {</span></span>
<span><span class="co">#&gt;     if (!Sys.getenv("R_CONFIG_ACTIVE") == "test") {</span></span>
<span><span class="co">#&gt;         cli::cli_abort("Please set the environment variable R_CONFIG_ACTIVE to 'test'.")</span></span>
<span><span class="co">#&gt;     }</span></span>
<span><span class="co">#&gt;     cli::cli_alert_info("Starting the build process...")</span></span>
<span><span class="co">#&gt;     cli::cli_alert_info("Fetching raw meta data from Lime Survey")</span></span>
<span><span class="co">#&gt;     LS_GetMasterData(export = TRUE)</span></span>
<span><span class="co">#&gt;     cli::cli_alert_info("Building metadata for the master data...")</span></span>
<span><span class="co">#&gt;     prepare_RawMeta(path = "metadata_raw.xlsx", export = TRUE)</span></span>
<span><span class="co">#&gt;     if (update) {</span></span>
<span><span class="co">#&gt;         metadata_raw &lt;- readxl::read_excel("metadata_raw.xlsx")</span></span>
<span><span class="co">#&gt;         DB_send(metadata_raw, "metadata_raw")</span></span>
<span><span class="co">#&gt;     }</span></span>
<span><span class="co">#&gt;     else {</span></span>
<span><span class="co">#&gt;         cli::cli_alert_warning("Skipping the update step. To update the DB, set update = TRUE.")</span></span>
<span><span class="co">#&gt;     }</span></span>
<span><span class="co">#&gt;     cli::cli_alert_info("Keep in mind that the sets and plots_headers* tables are not updated. Use DB_MetaUpdate to update them.")</span></span>
<span><span class="co">#&gt;     if (send_report) {</span></span>
<span><span class="co">#&gt;         cli::cli_alert_info("Sending the report...")</span></span>
<span><span class="co">#&gt;         send_Report()</span></span>
<span><span class="co">#&gt;     }</span></span>
<span><span class="co">#&gt;     else {</span></span>
<span><span class="co">#&gt;         cli::cli_alert_warning("Skipping the report send step. To send the report, set send_report = TRUE.")</span></span>
<span><span class="co">#&gt;     }</span></span>
<span><span class="co">#&gt;     cli::cli_alert_success("By the power of Grayskull: Building process completed.")</span></span>
<span><span class="co">#&gt; }</span></span>
<span><span class="co">#&gt; &lt;bytecode: 0x55a59998af30&gt;</span></span>
<span><span class="co">#&gt; &lt;environment: namespace:MetaMaster&gt;</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="metamaster-under-the-hood">MetaMaster Under the Hood<a class="anchor" aria-label="anchor" href="#metamaster-under-the-hood"></a>
</h2>
<p>In the first relevant step, the <code><a href="../reference/LS_GetMasterData.html">LS_GetMasterData()</a></code>
function creates the raw meta data. The function gets all master
templates from the LimeSurvey API and retrieves for each master the
survey question, id, so on. The function returns a tibble or exports the
data if the <code>export</code> parameter is set to
<code>TRUE</code>.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#Get the survey questions for the first three master templates</span></span>
<span><span class="fu"><a href="../reference/LS_GetMasterData.html">LS_GetMasterData</a></span><span class="op">(</span>export <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co"># ✔ Master Data exported.  </span></span></code></pre></div>
<p>The <code><a href="../reference/LS_GetMasterData.html">LS_GetMasterData()</a></code> is a wrapper function that
combines the <code><a href="../reference/LS_GetMasterTemplates.html">LS_GetMasterTemplates()</a></code> and the
<code><a href="../reference/LS_GetMasterQuestions.html">LS_GetMasterQuestions()</a></code> function. Under the hood, the
<code><a href="../reference/LS_GetMasterTemplates.html">LS_GetMasterTemplates()</a></code> function returns all templates from
the Lime Survey API if their name start with <code>master_</code>. More
precisely, it returns a tibble with the survey id, the survey title, and
the template name (from the master to template file).</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/LS_GetMasterTemplates.html">LS_GetMasterTemplates</a></span><span class="op">(</span>template <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co"># # A tibble: 95 × 3</span></span>
<span><span class="co">#    sid    surveyls_title                       template                       </span></span>
<span><span class="co">#    &lt;chr&gt;  &lt;chr&gt;                                &lt;chr&gt;                          </span></span>
<span><span class="co">#  1 197865 master_01_bfr_allg_gm_elt_00_2022_v4 tmpl_bfr_allg_gm_elt_00_2022_p1</span></span>
<span><span class="co">#  2 197865 master_01_bfr_allg_gm_elt_00_2022_v4 tmpl_bfr_allg_gm_elt_00_2022_p3</span></span>
<span><span class="co">#  3 197865 master_01_bfr_allg_gm_elt_00_2022_v4 tmpl_bfr_allg_rs_elt_00_2022_p1</span></span>
<span><span class="co">#  4 197865 master_01_bfr_allg_gm_elt_00_2022_v4 tmpl_bfr_beru_ws_elt_00_2022_p1</span></span>
<span><span class="co">#  5 943467 master_02_bfr_allg_gm_elt_01_2022_v4 tmpl_bfr_allg_gm_elt_01_2022_p2</span></span>
<span><span class="co">#  6 943467 master_02_bfr_allg_gm_elt_01_2022_v4 tmpl_bfr_allg_gm_elt_01_2022_p4</span></span>
<span><span class="co">#  7 866667 master_03_bfr_allg_gm_leh_00_2022_v4 tmpl_bfr_allg_gm_leh_00_2022_p1</span></span>
<span><span class="co">#  8 866667 master_03_bfr_allg_gm_leh_00_2022_v4 tmpl_bfr_allg_gm_leh_00_2022_p2</span></span>
<span><span class="co">#  9 866667 master_03_bfr_allg_gm_leh_00_2022_v4 tmpl_bfr_allg_gm_leh_00_2022_p3</span></span>
<span><span class="co"># 10 866667 master_03_bfr_allg_gm_leh_00_2022_v4 tmpl_bfr_allg_gm_leh_00_2022_p4</span></span>
<span><span class="co"># # ℹ 85 more rows</span></span>
<span><span class="co"># # ℹ Use `print(n = ...)` to see more rows</span></span></code></pre></div>
<p>The <code><a href="../reference/LS_GetMasterQuestions.html">LS_GetMasterQuestions()</a></code> function gets the survey
questions for a specific master template. The function needs the survey
id and the template name as input. The function returns a tibble with
the survey id, the template name, the plot, the variable, the text, and
the filter indicator.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/LS_GetMasterQuestions.html">LS_GetMasterQuestions</a></span><span class="op">(</span>id <span class="op">=</span> <span class="st">"197865"</span>, name <span class="op">=</span> <span class="st">"master_01_bfr_allg_gm_elt_00_2022_v4"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># # A tibble: 29 × 6</span></span>
<span><span class="co">#    surveyID template                             plot  variable      text              filter</span></span>
<span><span class="co">#    &lt;chr&gt;    &lt;chr&gt;                                &lt;chr&gt; &lt;chr&gt;         &lt;chr&gt;             &lt;chr&gt; </span></span>
<span><span class="co">#  1 197865   master_01_bfr_allg_gm_elt_00_2022_v4 E01   B131W124EB13a An dieser Schule… FALSE </span></span>
<span><span class="co">#  2 197865   master_01_bfr_allg_gm_elt_00_2022_v4 E01   B132aB13a     Mein Sohn/meine … FALSE </span></span>
<span><span class="co">#  3 197865   master_01_bfr_allg_gm_elt_00_2022_v4 E01   B132cB13a     Die Räume der Sc… FALSE </span></span>
<span><span class="co">#  4 197865   master_01_bfr_allg_gm_elt_00_2022_v4 E01   B133bB13a     Die Schule ist e… FALSE </span></span>
<span><span class="co">#  5 197865   master_01_bfr_allg_gm_elt_00_2022_v4 E02   B334W125aB33a An dieser Schule… FALSE </span></span>
<span><span class="co">#  6 197865   master_01_bfr_allg_gm_elt_00_2022_v4 E02   B334W125bB33a Wenn es Konflikt… FALSE </span></span>
<span><span class="co">#  7 197865   master_01_bfr_allg_gm_elt_00_2022_v4 E02   B333B33a      Mein Sohn/meine … FALSE </span></span>
<span><span class="co">#  8 197865   master_01_bfr_allg_gm_elt_00_2022_v4 E03   A632eA063     Mein Sohn/meine … FALSE </span></span>
<span><span class="co">#  9 197865   master_01_bfr_allg_gm_elt_00_2022_v4 E03   A633eA063     Mein Sohn/meine … FALSE </span></span>
<span><span class="co"># 10 197865   master_01_bfr_allg_gm_elt_00_2022_v4 E03   A631A063      Mein Sohn/meine … FALSE </span></span>
<span><span class="co"># # ℹ 19 more rows</span></span>
<span><span class="co"># # ℹ Use `print(n = ...)` to see more rows</span></span></code></pre></div>
<p>In the next step, the <code><a href="../reference/prepare_RawMeta.html">prepare_RawMeta()</a></code> function convert
the raw data into the master meta data. Based on the raw data, we build
two important tables. The <code>templates</code> table contains
information about the used report templates. And the <code>report</code>
table contains information about individual variables, plots, and the
labels for each report. Both are automatically updated if the
<code>update</code> parameter is set to <code>TRUE</code>.</p>
<p>In addition, the meta data includes tables which will not(!) be
generated automatically. Let’s revise them with the
<code><a href="../reference/DB_Table.html">DB_Table()</a></code> function, which grabs a table from the data
base. Two different types of tables cannot be generated automatically.
This is minor concern since they are small and easy to handle. First,
the <code>sets</code> table contains information about the (color) of
sets, the labels, and so on.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sets</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/DB_Table.html">DB_Table</a></span><span class="op">(</span><span class="st">"sets"</span><span class="op">)</span></span>
<span><span class="va">sets</span></span>
<span><span class="co"># # A tibble: 54 × 7</span></span>
<span><span class="co">#    set   code  labels               sort  colors  text_color timestamp          </span></span>
<span><span class="co">#    &lt;chr&gt; &lt;chr&gt; &lt;chr&gt;                &lt;chr&gt; &lt;chr&gt;   &lt;chr&gt;      &lt;dttm&gt;             </span></span>
<span><span class="co">#  1 set01 1     stimmt gar nicht     1     #7b3294 white      2024-11-07 14:32:34</span></span>
<span><span class="co">#  2 set01 2     stimmt eher nicht    2     #c2a5cf black      2024-11-07 14:32:34</span></span>
<span><span class="co">#  3 set01 3     stimmt zum Teil      3     #f7f7f7 black      2024-11-07 14:32:34</span></span>
<span><span class="co">#  4 set01 4     stimmt eher          4     #a6dba0 black      2024-11-07 14:32:34</span></span>
<span><span class="co">#  5 set01 5     stimmt ganz genau    5     #008837 white      2024-11-07 14:32:34</span></span>
<span><span class="co">#  6 set01 6     weiß nicht           6     #d0cece black      2024-11-07 14:32:34</span></span>
<span><span class="co">#  7 set03 1     gar nicht zufrieden  1     #7b3294 white      2024-11-07 14:32:34</span></span>
<span><span class="co">#  8 set03 2     eher nicht zufrieden 2     #c2a5cf black      2024-11-07 14:32:34</span></span>
<span><span class="co">#  9 set03 3     eher zufrieden       3     #a6dba0 black      2024-11-07 14:32:34</span></span>
<span><span class="co"># 10 set03 4     sehr zufrieden       4     #008837 white      2024-11-07 14:32:34</span></span>
<span><span class="co"># # ℹ 44 more rows</span></span></code></pre></div>
<p>Second, the <code>header_reports</code> table contains information
about plot name and the header(s) that will be printed in the
report.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">header_reports</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/DB_Table.html">DB_Table</a></span><span class="op">(</span><span class="st">"header_reports"</span><span class="op">)</span></span>
<span><span class="va">header_reports</span></span>
<span></span>
<span><span class="co"># # A tibble: 141 × 6</span></span>
<span><span class="co">#     sort plot  header1                            header2 timestamp           report</span></span>
<span><span class="co">#    &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt;                              &lt;chr&gt;   &lt;dttm&gt;              &lt;chr&gt; </span></span>
<span><span class="co">#  1     1 A11   A1 Klassenführung                  A1.1 D… 2024-12-07 10:04:12 Survey</span></span>
<span><span class="co">#  2     2 A12   A1 Klassenführung                  A1.2 D… 2024-12-07 10:04:12 Survey</span></span>
<span><span class="co">#  3     3 A13   A1 Klassenführung                  A1.3 D… 2024-12-07 10:04:12 Survey</span></span>
<span><span class="co">#  4     4 A21   A2 Nachvollziehbarkeit des Lernan… A2.1 D… 2024-12-07 10:04:12 Survey</span></span>
<span><span class="co">#  5     5 A22   A2 Nachvollziehbarkeit des Lernan… A2.2 D… 2024-12-07 10:04:12 Survey</span></span>
<span><span class="co">#  6     6 A32   A3 Variation der Lehr- und Lernme… A3.2 D… 2024-12-07 10:04:12 Survey</span></span>
<span><span class="co">#  7     7 A41   A4  Schülerorientierung            A4.1 B… 2024-12-07 10:04:12 Survey</span></span>
<span><span class="co">#  8     8 A42   A4 Schülerorientierung             A4.2 A… 2024-12-07 10:04:12 Survey</span></span>
<span><span class="co">#  9     9 A43   A4 Schülerorientierung             A4.3 D… 2024-12-07 10:04:12 Survey</span></span>
<span><span class="co"># 10    10 A51   A5 Berücksichtigung unterschiedli… A5.1 D… 2024-12-07 10:04:12 Survey</span></span>
<span><span class="co"># # ℹ 131 more rows</span></span>
<span><span class="co"># # ℹ Use `print(n = ...)` to see more rows</span></span></code></pre></div>
<p>These tables are small and there is no need to create them
automatically, but this not mean that errors in these tables will not
affect the reporting. Irrespective of the table, the MetaMaster comes
with several <code>check_*</code> functions for consistency checks (see
next section for more details). Those <code>check_*</code> functions are
included in the <code><a href="../reference/build.html">build()</a></code> function. More precisely, the
<code>blastula</code> package is used to create the email and the
<code>check_*</code> functions are embedded in the email template that
runs automatically if you set the <code>send_report</code> parameter to
<code>TRUE</code> <span class="citation">(Iannone and Cheng
2024)</span>. The next image shows a preview of the email.</p>
<p><img src="preview_mail.png" style="width:95.0%"></p>
<p>Thus, ehe email shows the results of the consistency checks and
includes the MetaMaster data as an attachment. In order to use this
feature, set the corresponding paramters in the <code>config.yml</code>
file and you need to provide the mail credentials (saved as
<code>my_mail_creds</code>) if they are not available. By default, the
email is sent from an to the OES email address.</p>
</div>
<div class="section level2">
<h2 id="further-friends-of-the-metamaster">Further Friends of the MetaMaster<a class="anchor" aria-label="anchor" href="#further-friends-of-the-metamaster"></a>
</h2>
<p>The MetaMaster contains further helper functions to work with the
Lime Survey API. Functions that check the consitency of the meta data;
functions to interact with the Lime Survey API; and functions to create
test scenarios. The following section provides a short overview.</p>
<div class="section level3">
<h3 id="checks">Checks<a class="anchor" aria-label="anchor" href="#checks"></a>
</h3>
<p>The <code><a href="../reference/check_distinct.html">check_distinct()</a></code> function checks the distinctness of
the survey questions. Based on the raw data, the function counts all
unique variable names and text. Next, it counts them and returns them if
they are appear more than once. The latter means that variable names and
text are not uniquely used.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/check_distinct.html">check_distinct</a></span><span class="op">(</span>ubb <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co"># ✖ Thou shalt not pass! Please check these duplicates:</span></span>
<span><span class="co"># # A tibble: 59 × 3</span></span>
<span><span class="co"># # Groups:   variable [27]</span></span>
<span><span class="co">#    variable  text                                                                              n</span></span>
<span><span class="co">#    &lt;chr&gt;     &lt;chr&gt;                                                                         &lt;int&gt;</span></span>
<span><span class="co">#  1 A112a     Die LK achtet konsequent auf die Einhaltung von Regeln.                           2</span></span>
<span><span class="co">#  2 A112a     Die LK achtet auf die Einhaltung von Regeln.                                      2</span></span>
<span><span class="co">#  3 A112b     Die SuS beachten die vereinbarten Regeln.                                         2</span></span>
<span><span class="co">#  4 A112b     Die LK achtet konsequent auf die Einhaltung von Regeln.                           2</span></span>
<span><span class="co">#  5 A113      Die LK geht mit Blick auf die Gruppe und den Einzelnen angemessen mit Störun…     2</span></span>
<span><span class="co">#  6 A113      Die LK geht angemessen mit Störungen um.                                          2</span></span>
<span><span class="co">#  7 A114      Die SuS reagieren auf Signale oder Hinweise der LK.                               2</span></span>
<span><span class="co">#  8 A114      Die SuS beachten die vereinbarten Regeln.                                         2</span></span>
<span><span class="co">#  9 A131W121b Die SuS pflegen einen wertschätzenden Umgang.                                     2</span></span>
<span><span class="co"># 10 A131W121b Die SuS pflegen einen wertschätzenden Umgang                                      2</span></span>
<span><span class="co"># # ℹ 49 more rows</span></span>
<span><span class="co"># # ℹ Use `print(n = ...)` to see more rows</span></span></code></pre></div>
<p>The <code><a href="../reference/check_MasterTemplates.html">check_MasterTemplates()</a></code> function checks if all
master templates listed in the <code>master_to_template</code> table are
in LimeSurvey and vice versa.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/check_MasterTemplates.html">check_MasterTemplates</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#✔ All Masters templates found in LimeSurvey (et vice versa).</span></span></code></pre></div>
<p>The <code><a href="../reference/check_SurveyTemplates.html">check_SurveyTemplates()</a></code> function checks if all
survey templates listed in the <code>master_to_template</code> table are
in meta data.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/check_SurveyTemplates.html">check_SurveyTemplates</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#✔ All survey templates found in meta data. </span></span></code></pre></div>
<p>In addition, the package has <code>check</code> function for all
tables that are not build via the LimeSurvey API. All of this function
run some standard checks to prevent common errors with regard to the
reporting. Thus, we check if all names are as expected, no missing
values are created by chance and so on.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#Check the sets</span></span>
<span><span class="fu"><a href="../reference/check_Sets.html">check_Sets</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co"># ℹ Checking sets data.</span></span>
<span><span class="co"># ✖ Some sets are not defined but are listed in the reports data. Check: "Freitext" and "NA".</span></span></code></pre></div>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/check_Headers.html">check_Headers</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co"># ℹ Checking header reports data.</span></span>
<span><span class="co"># ✔ The header_reports data looks awesome!</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="sent">Sent<a class="anchor" aria-label="anchor" href="#sent"></a>
</h3>
<p>The <code><a href="../reference/LS_SendSurvey.html">LS_SendSurvey()</a></code> function sends a survey template to
Lime Survey. The function needs the path to the survey template and the
name of the survey template. It expects the survey template to be in the
LimeSurvey LSS format.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/LS_SendSurvey.html">LS_SendSurvey</a></span><span class="op">(</span>lss <span class="op">=</span> <span class="st">"limesurveyMod.lss"</span>, </span>
<span>              name <span class="op">=</span> <span class="st">"mastertemplate"</span><span class="op">)</span></span></code></pre></div>
<p>The <code><a href="../reference/LS_SendSurveys.html">LS_SendSurveys()</a></code> function is a wrapper around
<code><a href="../reference/LS_SendSurvey.html">LS_SendSurvey()</a></code>. It sends all survey templates in the
working directory to Lime Survey.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/LS_SendSurveys.html">LS_SendSurveys</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="delete">Delete<a class="anchor" aria-label="anchor" href="#delete"></a>
</h3>
<p>The <code><a href="../reference/LS_DeleteSurvey.html">LS_DeleteSurvey()</a></code> function deletes a survey from
LimeSurvey. The function needs the survey ID of the survey template. Be
careful, there is no way to restore a deleted survey.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/LS_DeleteSurvey.html">LS_DeleteSurvey</a></span><span class="op">(</span>sid <span class="op">=</span> <span class="st">"123456"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="create-test-scenarios">Create Test Scenarios<a class="anchor" aria-label="anchor" href="#create-test-scenarios"></a>
</h3>
<p>The <code><a href="../reference/create_TestSchools.html">create_TestSchools()</a></code> function creates test scenarios
for the MetaMaster. The function creates for each master template a test
school. The function returns a tibble with the survey id, the survey
title, the template name, the school, the new name, the snr, and the
test school.</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/create_TestSchools.html">create_TestSchools</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co"># # A tibble: 38 × 8</span></span>
<span><span class="co">#       sid surveyls_title                   template file  school new_name snr   test_school</span></span>
<span><span class="co">#     &lt;int&gt; &lt;chr&gt;                            &lt;chr&gt;    &lt;chr&gt; &lt;chr&gt;  &lt;chr&gt;    &lt;chr&gt; &lt;chr&gt;      </span></span>
<span><span class="co">#  1 197865 master_01_bfr_allg_gm_elt_00_20… tmpl_bf… NA    gm     bfr_all… 8934  8934_20242…</span></span>
<span><span class="co">#  2 943467 master_02_bfr_allg_gm_elt_01_20… tmpl_bf… NA    gm     bfr_all… 8934  8934_20242…</span></span>
<span><span class="co">#  3 866667 master_03_bfr_allg_gm_leh_00_20… tmpl_bf… NA    gm     bfr_all… 8934  8934_20242…</span></span>
<span><span class="co">#  4 383484 master_04_bfr_allg_gs_elt_00_20… tmpl_bf… NA    gs     bfr_all… 1208  1208_20242…</span></span>
<span><span class="co">#  5 687118 master_05_bfr_allg_gs_elt_01_20… tmpl_bf… NA    gs     bfr_all… 1208  1208_20242…</span></span>
<span><span class="co">#  6 661758 master_06_bfr_allg_gs_leh_00_20… tmpl_bf… NA    gs     bfr_all… 1208  1208_20242…</span></span>
<span><span class="co">#  7 386673 master_07_bfr_allg_gs_sus_00_20… tmpl_bf… NA    zspf_… bfr_zsp… 6009  6009_20242…</span></span>
<span><span class="co">#  8 956526 master_08_bfr_allg_gs_sus_02_20… tmpl_bf… NA    zspf_… bfr_zsp… 6009  6009_20242…</span></span>
<span><span class="co">#  9 533711 master_09_bfr_allg_gy_elt_00_20… tmpl_bf… NA    beru_… bfr_ber… 0850  0850_20242…</span></span>
<span><span class="co"># 10 197211 master_10_bfr_allg_gy_elt_01_20… tmpl_bf… NA    gy     bfr_all… 0001  0001_20242…</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="lime-survey-templates">Lime Survey Templates<a class="anchor" aria-label="anchor" href="#lime-survey-templates"></a>
</h3>
<p>Note that the Lime Survey templates (LSS) are stored in the database
and you can make an update via the <code><a href="../reference/DB_UploadLSS.html">DB_UploadLSS()</a></code>
function.</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">lss_surveys</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/DB_Table.html">DB_Table</a></span><span class="op">(</span><span class="st">"lss_surveys"</span><span class="op">)</span></span>
<span><span class="va">lss_surveys</span><span class="op">$</span><span class="va">survey_data</span></span>
<span></span>
<span><span class="co"># A tibble: 38 × 4</span></span>
<span><span class="co"># id file_id master                               survey_data                              </span></span>
<span><span class="co">#    &lt;int&gt; &lt;chr&gt;   &lt;chr&gt;                                &lt;pq_xml&gt;                          </span></span>
<span><span class="co">#  1   384 153447  master_11_bfr_allg_gy_sus_00_2022_v4 &lt;document&gt;</span></span>
<span><span class="co">#   &lt;LimeSurveyDocType&gt;Survey&lt;/LimeSurveyDocType&gt;</span></span>
<span><span class="co">#   &lt;DBVersi…</span></span>
<span><span class="co">#  2   385 165568  master_17_bfr_allg_rs_sus_00_2022_v4 &lt;document&gt;</span></span>
<span><span class="co">#   &lt;LimeSurveyDocType&gt;Survey&lt;/LimeSurveyDocType&gt;</span></span>
<span><span class="co">#   &lt;DBVersi…</span></span>
<span><span class="co">#  3   386 197211  tmpl_bfr_allg_gy_elt_01_2022_p2      &lt;document&gt;</span></span>
<span><span class="co">#   &lt;LimeSurveyDocType&gt;Survey&lt;/LimeSurveyDocType&gt;</span></span>
<span><span class="co">#   &lt;DBVersi…</span></span>
<span><span class="co">#  4   387 197865  tmpl_bfr_allg_gm_elt_00_2022_p1      &lt;document&gt;</span></span>
<span><span class="co">#   &lt;LimeSurveyDocType&gt;Survey&lt;/LimeSurveyDocType&gt;</span></span>
<span><span class="co">#   &lt;DBVersi…</span></span>
<span><span class="co">#  5   388 311393  master_21_bfr_beru_bq_sus_00_2022_v4 &lt;document&gt;</span></span>
<span><span class="co">#   &lt;LimeSurveyDocType&gt;Survey&lt;/LimeSurveyDocType&gt;</span></span>
<span><span class="co">#   &lt;DBVersi…</span></span></code></pre></div>
<p>In a similar sense, the <code><a href="../reference/LS_UploadTemplates.html">LS_UploadTemplates()</a></code> function
uploads all Lime Survey master templates via the API. It takes each
master template and uploads as a survey template to Lime Survey.</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/LS_UploadTemplates.html">LS_UploadTemplates</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level2 unnumbered">
<h2 class="unnumbered" id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<div id="refs" class="references csl-bib-body hanging-indent" entry-spacing="0">
<div id="ref-config" class="csl-entry">
Allaire, JJ. 2023. <span>“Config: Manage Environment Specific
Configuration Values.”</span> <a href="https://CRAN.R-project.org/package=config" class="external-link">https://CRAN.R-project.org/package=config</a>.
</div>
<div id="ref-blastula" class="csl-entry">
Iannone, Richard, and Joe Cheng. 2024. <span>“Blastula: Easily Send HTML
Email Messages.”</span> <a href="https://CRAN.R-project.org/package=blastula" class="external-link">https://CRAN.R-project.org/package=blastula</a>.
</div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by <a href="https://www.edgar-treischl.de/" class="external-link">Edgar Treischl</a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
